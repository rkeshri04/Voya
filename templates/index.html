<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech to ASL-fingerspelling Translator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: #fff;
            box-shadow: 0 8px 32px rgba(60,72,88,0.12);
            border-radius: 24px;
            padding: 40px 32px;
            display: flex;
            gap: 48px;
            max-width: 1200px;
            width: 100%;
        }
        .speech-section {
            flex: 1;
        }
        .asl-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        .asl-output {
            min-height: 200px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: center;
            width: 100%;
            overflow-x: auto;
        }
        .asl-word-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            max-width: 100%;
            overflow-x: auto;
        }
        .asl-char {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            background: #e0e7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 2px 8px rgba(60,72,88,0.08);
            transition: background 0.2s;
        }
        .mic-btn {
            background: #6366f1;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(99,102,241,0.18);
            transition: background 0.2s;
        }
        .mic-btn.active {
            background: #22d3ee;
        }
        .speech-text {
            font-size: 1.25rem;
            margin-top: 24px;
            color: #334155;
            min-height: 48px;
        }
        @media (max-width: 800px) {
            .container {
                flex-direction: column;
                padding: 24px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="speech-section">
            <h2>Speak to Translate</h2>
            <button class="mic-btn" id="micBtn" title="Start/Stop Listening">
                <span id="micIcon">ðŸŽ¤</span>
            </button>
            <div class="speech-text" id="speechText">Click the mic and start speaking...</div>
        </div>
        <div class="asl-section">
            <h2>ASL Translation</h2>
            <div style="margin-bottom: 16px;">
                <label style="font-weight: 500; margin-right: 12px;">
                    <input type="radio" name="aslMode" value="individual" id="modeIndividual" checked>
                    Individual
                </label>
                <label style="font-weight: 500;">
                    <input type="radio" name="aslMode" value="group" id="modeGroup">
                    Group
                </label>
            </div>
            <div class="asl-output" id="aslOutput"></div>
        </div>
    </div>
    <script>
        // Web Speech API setup
        const micBtn = document.getElementById('micBtn');
        const speechText = document.getElementById('speechText');
        const aslOutput = document.getElementById('aslOutput');
        let recognizing = false;
        let recognition;
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                recognizing = true;
                micBtn.classList.add('active');
                speechText.textContent = 'Listening...';
            };
            recognition.onend = () => {
                recognizing = false;
                micBtn.classList.remove('active');
                speechText.textContent = 'Click the mic and start speaking...';
            };
            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    transcript += event.results[i][0].transcript;
                }
                speechText.textContent = transcript;
                showASL(transcript);
            };
        } else {
            micBtn.disabled = true;
            speechText.textContent = 'Web Speech API not supported in this browser.';
        }

        micBtn.onclick = () => {
            if (recognizing) {
                recognition.stop();
            } else {
                recognition.start();
            }
        };

        let aslMode = 'individual';
        let timer; // keep timer global so it's easily cleared

        document.getElementById('modeIndividual').onchange = () => { aslMode = 'individual'; };
        document.getElementById('modeGroup').onchange = () => { aslMode = 'group'; };

        function showASL(text) {
            aslOutput.innerHTML = '';
            text = text.toLowerCase().replace(/[^a-z0-9 ]/g, '');
            if (timer) {
                clearTimeout(timer);
                timer = null;
            }
            fetch('/api/asl-translate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, mode: aslMode })
            })
            .then(res => res.json())
            .then(data => {
                if (data.mode === 'individual') {
                    const chars = data.result;
                    let charIndex = 0;
                    function showNextChar() {
                        aslOutput.innerHTML = '';
                        if (charIndex < chars.length) {
                            const { char, img } = chars[charIndex];
                            if (img) {
                                const wrapper = document.createElement('div');
                                wrapper.style.display = 'flex';
                                wrapper.style.flexDirection = 'column';
                                wrapper.style.alignItems = 'center';
                                const imgElem = document.createElement('img');
                                imgElem.src = img;
                                imgElem.alt = `ASL ${char}`;
                                imgElem.className = 'asl-char';
                                imgElem.style.width = '120px';
                                imgElem.style.height = '120px';
                                imgElem.style.fontSize = '4rem';
                                const label = document.createElement('div');
                                label.textContent = char.toUpperCase();
                                label.style.marginTop = '16px';
                                label.style.fontSize = '2rem';
                                label.style.fontWeight = 'bold';
                                label.style.color = '#6366f1';
                                wrapper.appendChild(imgElem);
                                wrapper.appendChild(label);
                                aslOutput.appendChild(wrapper);
                            }
                            charIndex++;
                            timer = setTimeout(showNextChar, 450);
                        }
                    }
                    if (chars.length > 0) showNextChar();
                } else {
                    const words = data.result;
                    let wordIndex = 0;
                    function showNextWord() {
                        aslOutput.innerHTML = '';
                        if (wordIndex < words.length) {
                            const wordObj = words[wordIndex];
                            const wordWrapper = document.createElement('div');
                            wordWrapper.style.display = 'flex';
                            wordWrapper.style.flexDirection = 'column';
                            wordWrapper.style.alignItems = 'center';
                            wordWrapper.style.marginBottom = '24px';
                            const imagesRow = document.createElement('div');
                            imagesRow.className = 'asl-word-row';
                            for (const charObj of wordObj.chars) {
                                if (charObj.img) {
                                    const imgElem = document.createElement('img');
                                    imgElem.src = charObj.img;
                                    imgElem.alt = `ASL ${charObj.char}`;
                                    imgElem.className = 'asl-char';
                                    imgElem.style.width = '80px';
                                    imgElem.style.height = '80px';
                                    imagesRow.appendChild(imgElem);
                                }
                            }
                            const label = document.createElement('div');
                            label.textContent = wordObj.word.toUpperCase();
                            label.style.marginTop = '16px';
                            label.style.fontSize = '2rem';
                            label.style.fontWeight = 'bold';
                            label.style.color = '#6366f1';
                            wordWrapper.appendChild(imagesRow);
                            wordWrapper.appendChild(label);
                            aslOutput.appendChild(wordWrapper);
                            wordIndex++;
                            const delay = Math.max(1200, Math.min(wordObj.chars.length * 500, 3000));
                            timer = setTimeout(showNextWord, delay);
                        }
                    }
                    if (words.length > 0) showNextWord();
                }
            });
        }
    </script>
</body>
</html>
